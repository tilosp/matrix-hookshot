Refactor connection handling logic to improve developer experience.